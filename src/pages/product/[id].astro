---
import Layout from "../../layouts/Layout.astro"
import { defaultLocale } from "../../i18n/config"
import ProductDetailApp from "../../components/catalog/ProductDetailApp"

// Generate pages for all existing products
// New products will load client-side via the same template
export async function getStaticPaths() {
  // Import ProductService dynamically to avoid build-time Firebase issues
  const { ProductService } = await import('../../services/ProductService');
  const productService = new ProductService();

  try {
    const res = await productService.getProducts({ publishedOnly: true }, { limit: 5000 });
    
    // Generate paths for all existing products
    const paths = res.data.map((product) => ({
      params: { id: product.id },
    }));
    
    // Add a catch-all fallback that will handle new products
    // This ensures the same HTML template is used for all product IDs
    return paths.length > 0 ? paths : [{ params: { id: 'fallback' } }];
  } catch (error) {
    console.error("Error generating product static paths:", error);
    // Return at least one fallback path so the route exists
    return [{ params: { id: 'fallback' } }];
  }
}

const { id } = Astro.params

if (!id || id === 'fallback') {
  // Don't redirect, let the client-side app handle it
}
---

<Layout 
  title="LuLuna Jewelry - Producto" 
  description="Detalles del producto de joyerÃ­a artesanal" 
  lang={defaultLocale}
>
  <ProductDetailApp client:only="react" productId={id} />
</Layout>
